from util import *
# Calculate DGL periods

### Initialize
p = 5
M = 4
parallelize = False
embedding_idx = 0
D = -1
x = QQ['x'].gen()
F.<r> = QuadraticField(D)
Fp = Qp(p,2*M, type='floating-point')
Rp = Zmod(p**M)
eps = F.unit_group().gens()[0]
units = [F(eps**i) for i in range(eps.multiplicative_order())]
phi = F.hom([F.gen().minpoly().roots(Fp)[embedding_idx][0]],check=False)
print(phi)
Ruv = PolynomialRing(PolynomialRing(Rp,'u'),'v')
inv_map_poly = Ruv.flattening_morphism()
map_poly = inv_map_poly.inverse()
load('orthogonal.sage')

MS = calculate_Tp_matrices(1+2*r)
functional_list = vanishing_functional(10)


###
zero_discs = [32, 88, 92, 152, 153, 168, 172, 188, 232, 248, 252, 268, 272, 308, 312, 328, 332, 348, 368]
found_discs = {D : [] for D in zero_discs}
for i, v in enumerate(functional_list):
    L0, V = initial_seed(v, p)
    F1, dg = Level1(V)
    F1 = Next(F1, MS)
    J = RMC(F1)
    for D in zero_discs:
        A = compute_gamma_tau(D)
        try:
            x1, x10, x11 = RMCEval(L0, J, A)
        except PrecisionError:
            print(f'Discriminant {D} cannot be evaluated for cocycle {i}')
            continue
        if (x1 - 1).valuation() < 2:
            print(f'Discriminant {D} gives nonzero for cocycle {i}')
            found_discs[D].append(v)

for D, val in found_discs.items():
    print(f'{D = }')
    print(val)
    print('----')


## RESULT
r'''
D = 32
[(0, 0, 0, 1, 0, 0, 0, -1, 0), (0, 1, 0, -1, 0, 0, 0, 0, 0), (1, 0, 0, 0, 0, 1, 0, 0, -1), (1, 1, 0, 1, 0, -1, -1, 0, 1), (2, 1, 1, 1, 0, -1, 0, 0, 0), (1, 0, -1, 0, 3, -1, 0, -1, 0)]
----
D = 88
[(0, 0, 0, 1, 0, 0, 0, -1, 0), (0, 1, 0, -1, 0, 0, 0, 0, 0), (1, 0, 0, 0, 0, 1, 0, 0, -1), (1, 1, 0, 1, 0, -1, -1, 0, 1), (2, 1, 1, 1, 0, -1, 0, 0, 0), (1, 0, -1, 0, 3, -1, 0, -1, 0)]
----
D = 92
[(0, 0, 0, 1, 0, 0, 0, -1, 0), (0, 1, 0, -1, 0, 0, 0, 0, 0), (1, 0, 0, 0, 0, 1, 0, 0, -1), (1, 1, 0, 1, 0, -1, -1, 0, 1), (2, 1, 1, 1, 0, -1, 0, 0, 0), (1, 0, -1, 0, 3, -1, 0, -1, 0)]
----
D = 152
[(0, 0, 0, 1, 0, 0, 0, -1, 0), (0, 1, 0, -1, 0, 0, 0, 0, 0), (1, 0, 0, 0, 0, 1, 0, 0, -1), (1, 1, 0, 1, 0, -1, -1, 0, 1), (2, 1, 1, 1, 0, -1, 0, 0, 0), (1, 0, -1, 0, 3, -1, 0, -1, 0)]
----
D = 153
[(0, 1, 0, -1, 0, 0, 0, 0, 0), (0, 0, 1, 0, 0, -1, 1, 0, 0)]
----
D = 168
[(0, 0, 0, 1, 0, 0, 0, -1, 0), (0, 1, 0, -1, 0, 0, 0, 0, 0), (1, 0, 0, 0, 0, 1, 0, 0, -1), (1, 1, 0, 1, 0, -1, -1, 0, 1), (1, 0, -1, 0, 3, -1, 0, -1, 0)]
----
D = 172
[(0, 0, 0, 1, 0, 0, 0, -1, 0), (0, 1, 0, -1, 0, 0, 0, 0, 0), (1, 0, 0, 0, 0, 1, 0, 0, -1), (1, 1, 0, 1, 0, -1, -1, 0, 1), (2, 1, 1, 1, 0, -1, 0, 0, 0), (1, 0, -1, 0, 3, -1, 0, -1, 0)]
----
D = 188
[(0, 0, 0, 1, 0, 0, 0, -1, 0), (0, 1, 0, -1, 0, 0, 0, 0, 0), (1, 0, 0, 0, 0, 1, 0, 0, -1), (1, 1, 0, 1, 0, -1, -1, 0, 1), (2, 1, 1, 1, 0, -1, 0, 0, 0), (1, 0, -1, 0, 3, -1, 0, -1, 0)]
----
D = 232
[(0, 0, 0, 1, 0, 0, 0, -1, 0), (0, 1, 0, -1, 0, 0, 0, 0, 0), (1, 0, 0, 0, 0, 1, 0, 0, -1), (1, -1, 0, 0, 0, 0, -1, -1, 1), (1, 1, 0, 1, 0, -1, -1, 0, 1), (2, 1, 1, 1, 0, -1, 0, 0, 0), (1, 0, -1, 0, 3, -1, 0, -1, 0)]
----
D = 248
[(0, 0, 0, 1, 0, 0, 0, -1, 0), (0, 1, 0, -1, 0, 0, 0, 0, 0), (1, 0, 0, 0, 0, 1, 0, 0, -1), (2, 1, 1, 1, 0, -1, 0, 0, 0), (1, 0, -1, 0, 3, -1, 0, -1, 0)]
----
D = 252
[(0, 0, 0, 1, 0, 0, 0, -1, 0), (0, 1, 0, -1, 0, 0, 0, 0, 0), (1, 0, 0, 0, 0, 1, 0, 0, -1), (1, 1, 0, 1, 0, -1, -1, 0, 1), (2, 1, 1, 1, 0, -1, 0, 0, 0), (1, 0, -1, 0, 3, -1, 0, -1, 0)]
----
D = 268
[(0, 0, 0, 1, 0, 0, 0, -1, 0), (0, 1, 0, -1, 0, 0, 0, 0, 0), (1, 0, 0, 0, 0, 1, 0, 0, -1), (1, -1, 0, 0, 0, 0, -1, -1, 1), (1, 1, 0, 1, 0, -1, -1, 0, 1), (2, 1, 1, 1, 0, -1, 0, 0, 0), (1, 0, -1, 0, 3, -1, 0, -1, 0)]
----
D = 272
[(0, 0, 0, 1, 0, 0, 0, -1, 0), (0, 1, 0, -1, 0, 0, 0, 0, 0), (1, 0, 0, 0, 0, 1, 0, 0, -1), (1, 1, 0, 1, 0, -1, -1, 0, 1), (2, 1, 1, 1, 0, -1, 0, 0, 0), (1, 0, -1, 0, 3, -1, 0, -1, 0)]
----
D = 308
[(0, 0, 0, 1, 0, 0, 0, -1, 0), (0, 1, 0, -1, 0, 0, 0, 0, 0), (1, 0, 0, 0, 0, 1, 0, 0, -1), (1, 1, 0, 1, 0, -1, -1, 0, 1), (2, 1, 1, 1, 0, -1, 0, 0, 0), (1, 0, -1, 0, 3, -1, 0, -1, 0)]
----
D = 312
[(0, 0, 0, 1, 0, 0, 0, -1, 0), (0, 1, 0, -1, 0, 0, 0, 0, 0), (1, 0, 0, 0, 0, 1, 0, 0, -1), (1, 1, 0, 1, 0, -1, -1, 0, 1), (2, 1, 1, 1, 0, -1, 0, 0, 0), (1, 0, -1, 0, 3, -1, 0, -1, 0)]
----
D = 328
[(0, 0, 0, 1, 0, 0, 0, -1, 0), (0, 1, 0, -1, 0, 0, 0, 0, 0), (1, 0, 0, 0, 0, 1, 0, 0, -1), (1, -1, 0, 0, 0, 0, -1, -1, 1), (1, 1, 0, 1, 0, -1, -1, 0, 1), (2, 1, 1, 1, 0, -1, 0, 0, 0), (1, 0, -1, 0, 3, -1, 0, -1, 0)]
----
D = 332
[(0, 0, 0, 1, 0, 0, 0, -1, 0), (0, 1, 0, -1, 0, 0, 0, 0, 0), (1, 0, 0, 0, 0, 1, 0, 0, -1), (1, 1, 0, 1, 0, -1, -1, 0, 1), (2, 1, 1, 1, 0, -1, 0, 0, 0), (1, 0, -1, 0, 3, -1, 0, -1, 0)]
----
D = 348
[(0, 0, 0, 1, 0, 0, 0, -1, 0), (0, 1, 0, -1, 0, 0, 0, 0, 0), (1, 0, 0, 0, 0, 1, 0, 0, -1), (1, 1, 0, 1, 0, -1, -1, 0, 1), (2, 1, 1, 1, 0, -1, 0, 0, 0), (1, 0, -1, 0, 3, -1, 0, -1, 0)]
----
D = 368
[(0, 0, 0, 1, 0, 0, 0, -1, 0), (0, 1, 0, -1, 0, 0, 0, 0, 0), (1, 0, 0, 0, 0, 1, 0, 0, -1), (1, 1, 0, 1, 0, -1, -1, 0, 1), (2, 1, 1, 1, 0, -1, 0, 0, 0), (1, 0, -1, 0, 3, -1, 0, -1, 0)]
----
'''
